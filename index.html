<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>第五人格监管者倒计时面板 v3</title>
<style>
  body {
    font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
    background: #fff;
    color: #111;
    margin: 0;
    padding: 0;
  }
  header {
    background: #f3f3f3;
    border-bottom: 1px solid #ddd;
    padding: 10px 20px;
    text-align: center;
  }
  h1 {
    margin: 0;
    font-size: 20px;
  }
  .container {
    padding: 10px 20px;
  }
  .module {
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    background: #fafafa;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  .module h2 {
    margin-top: 0;
    font-size: 16px;
  }
  .timer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 5px 0;
  }
  .timer input {
    width: 50px;
  }
  button {
    border: none;
    background: #4a90e2;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover { background: #357ab8; }
  .small { font-size: 12px; color: #666; }
  .highlight { color: #e74c3c; font-weight: bold; }
  .gray { color: #aaa; }
  .settings {
    text-align: right;
  }
  .settings button {
    background: #aaa;
    padding: 4px 8px;
    font-size: 12px;
  }
</style>
</head>
<body>
<header>
  <h1>第五人格监管者倒计时面板 v3</h1>
  <div class="small">白底简洁风格・自定义可保存・语音播报版</div>
</header>

<div class="container">
  <!-- 功能一：监管者选择 -->
  <div class="module" id="module1">
    <div class="settings"><button onclick="openSettings('module1')">⚙️ 自定义</button></div>
    <h2>功能一：选择监管者</h2>
    <select id="hunterSelect" onchange="selectHunter()">
      <option value="">请选择监管者</option>
      <option value="厂长">厂长</option>
      <option value="宿伞之魂">宿伞之魂</option>
      <option value="渔女">渔女</option>
      <option value="红夫人">红夫人</option>
      <option value="红蝶">红蝶</option>
      <option value="噩梦">噩梦</option>
    </select>
    <div id="hunterInfo" class="small gray">选择监管者后将高亮技能和天赋</div>
  </div>

  <!-- 功能二：大技能冷却倒计时 -->
  <div class="module" id="module2">
    <div class="settings"><button onclick="openSettings('module2')">⚙️ 自定义</button></div>
    <h2>功能二：大技能冷却倒计时</h2>
    <div class="timer">
      <span>全局倒计时：</span>
      <span id="mainTimer">238</span>s
      <button onclick="startMainTimer()">开始</button>
      <button onclick="resetMainTimer()">重置</button>
    </div>
    <div class="small gray">到不同秒数自动播报：失常/兴奋/传送等冷却结束</div>
  </div>

  <!-- 功能三：天赋推测 -->
  <div class="module" id="module3">
    <div class="settings"><button onclick="openSettings('module3')">⚙️ 自定义</button></div>
    <h2>功能三：天赋推测</h2>
    <div class="small">点击切换概率状态：</div>
    <div id="talents">
      <button onclick="toggleState(this)">破坏欲</button>
      <button onclick="toggleState(this)">幽闭恐惧</button>
      <button onclick="toggleState(this)">追猎</button>
    </div>
  </div>

  <!-- 功能四：地图选择 -->
  <div class="module" id="module4">
    <div class="settings"><button onclick="openSettings('module4')">⚙️ 自定义</button></div>
    <h2>功能四：地图与地窖</h2>
    <select id="mapSelect">
      <option>军工厂</option>
      <option>圣心医院</option>
      <option>红教堂</option>
      <option>湖景村</option>
    </select>
    <div class="small gray">可在此标注地窖点为“已排除”或“已确认”</div>
  </div>
</div>

<!-- 自定义设置窗口 -->
<div id="settingsModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);">
  <div style="background:white;margin:10% auto;padding:20px;width:90%;max-width:400px;border-radius:10px;">
    <h3>模块自定义设置</h3>
    <textarea id="settingsInput" style="width:100%;height:100px;"></textarea>
    <div style="text-align:right;margin-top:10px;">
      <button onclick="saveSettings()">保存</button>
      <button onclick="closeSettings()">关闭</button>
    </div>
  </div>
</div>

<script>
let mainTimer, mainTime = 238;
let settingsTarget = '';

function speak(text){
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'zh-CN';
  speechSynthesis.speak(u);
}

function startMainTimer(){
  clearInterval(mainTimer);
  let time = mainTime;
  mainTimer = setInterval(()=>{
    document.getElementById('mainTimer').textContent = time;
    if(time===208) speak('巡视者冷却结束');
    if(time===193) speak('传送冷却结束');
    if(time===178) speak('闪现冷却结束');
    if(time===188) speak('移形冷却结束');
    if(time===118) speak('底牌冷却结束');
    if(time<=0){clearInterval(mainTimer);speak('倒计时结束');}
    time--;
  },1000);
}

function resetMainTimer(){
  clearInterval(mainTimer);
  document.getElementById('mainTimer').textContent = mainTime;
}

function selectHunter(){
  const val = document.getElementById('hunterSelect').value;
  document.getElementById('hunterInfo').textContent = val ? '已选择：'+val+'，技能与天赋已高亮' : '请选择监管者';
  if(val) speak('已选择监管者' + val);
}

function toggleState(btn){
  const states = ['','高概率','低概率','已确认'];
  let current = btn.dataset.state ? parseInt(btn.dataset.state) : 0;
  current = (current+1)%4;
  btn.dataset.state = current;
  btn.className = current===1?'highlight':current===2?'gray':current===3?'highlight':'';
  btn.textContent = btn.textContent.split(' ')[0] + (states[current] ? '（'+states[current]+'）' : '');
}

function openSettings(id){
  settingsTarget = id;
  const data = localStorage.getItem(id+'_custom') || '';
  document.getElementById('settingsInput').value = data;
  document.getElementById('settingsModal').style.display='block';
}

function closeSettings(){
  document.getElementById('settingsModal').style.display='none';
}

function saveSettings(){
  const val = document.getElementById('settingsInput').value;
  localStorage.setItem(settingsTarget+'_custom', val);
  closeSettings();
  alert('设置已保存，下次打开会自动加载');
}
</script>
</body>
</html>
